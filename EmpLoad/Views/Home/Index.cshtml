@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using EmpLoad.Models.Foundations.Employees
@model List<Employee>
@{
    ViewData["Title"] = "Employee Import";
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<h2>Import Employees</h2>

<form asp-action="Import" asp-controller="Home" method="post" enctype="multipart/form-data">
    <div>
        <label>Select CSV File:</label>
        <input type="file" name="file" required />
        <button type="submit" class="btn btn-primary">Import</button>
    </div>
</form>

@if (ViewBag.Message != null)
{
    <div class="alert alert-success mt-3">@ViewBag.Message</div>
}

@if (Model != null && Model.Count > 0)
{
    <h3 class="mt-4">Employees List</h3>
    <table id="employeesTable" class="display">
        <thead>
            <tr>
                <th>Payroll #</th>
                <th>Forenames</th>
                <th>Surname</th>
                <th>DOB</th>
                <th>Phone</th>
                <th>Mobile</th>
                <th>Address</th>
                <th>Address 2</th>
                <th>Postcode</th>
                <th>Email</th>
                <th>Start Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var e in Model)
            {
                <tr>
                    <td>@e.PayrollNumber</td>
                    <td>@e.Forenames</td>
                    <td>@e.Surname</td>
                    <td>@e.DateOfBirth.ToShortDateString()</td>
                    <td>@e.Telephone</td>
                    <td>@e.Mobile</td>
                    <td>@e.Address</td>
                    <td>@e.Address2</td>
                    <td>@e.Postcode</td>
                    <td>@e.EmailHome</td>
                    <td>@e.StartDate.ToShortDateString()</td>
                    <td>
                        <button class="btn btn-sm btn-warning editBtn"
                                data-id="@e.Id"
                                data-payrollnumber="@e.PayrollNumber"
                                data-forenames="@e.Forenames"
                                data-surname="@e.Surname"
                                data-dob="@e.DateOfBirth.ToString("yyyy-MM-dd")"
                                data-telephone="@e.Telephone"
                                data-mobile="@e.Mobile"
                                data-address="@e.Address"
                                data-address2="@e.Address2"
                                data-postcode="@e.Postcode"
                                data-email="@e.EmailHome"
                                data-startdate="@e.StartDate.ToString("yyyy-MM-dd")">
                            Edit
                        </button>
                        <form asp-action="Delete" asp-controller="Home" method="post" class="d-inline">
                            <input type="hidden" name="employeeId" value="@e.Id" />
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this employee?');">Delete</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <form asp-action="Edit" asp-controller="Home" method="post" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Employee</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" name="Id" id="editId" />

                <div class="mb-2">
                    <label>Payroll Number</label>
                    <input type="text" class="form-control" name="PayrollNumber" id="editPayrollNumber" />
                </div>

                <div class="mb-2">
                    <label>Forenames</label>
                    <input type="text" class="form-control" name="Forenames" id="editForenames" />
                </div>

                <div class="mb-2">
                    <label>Surname</label>
                    <input type="text" class="form-control" name="Surname" id="editSurname" />
                </div>

                <div class="mb-2">
                    <label>Date of Birth</label>
                    <input type="date" class="form-control" name="DateOfBirth" id="editDOB" />
                </div>

                <div class="mb-2">
                    <label>Telephone</label>
                    <input type="text" class="form-control" name="Telephone" id="editTelephone" />
                </div>

                <div class="mb-2">
                    <label>Mobile</label>
                    <input type="text" class="form-control" name="Mobile" id="editMobile" />
                </div>

                <div class="mb-2">
                    <label>Address</label>
                    <input type="text" class="form-control" name="Address" id="editAddress" />
                </div>

                <div class="mb-2">
                    <label>Address 2</label>
                    <input type="text" class="form-control" name="Address2" id="editAddress2" />
                </div>

                <div class="mb-2">
                    <label>Postcode</label>
                    <input type="text" class="form-control" name="Postcode" id="editPostcode" />
                </div>

                <div class="mb-2">
                    <label>Email</label>
                    <input type="email" class="form-control" name="EmailHome" id="editEmail" />
                </div>

                <div class="mb-2">
                    <label>Start Date</label>
                    <input type="date" class="form-control" name="StartDate" id="editStartDate" />
                </div>
            </div>

            <div class="modal-footer">
                <button type="submit" class="btn btn-success">Save</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#employeesTable').DataTable();

        $('.editBtn').click(function () {
            $('#editId').val($(this).data('id'));
            $('#editPayrollNumber').val($(this).data('payrollnumber'));
            $('#editForenames').val($(this).data('forenames'));
            $('#editSurname').val($(this).data('surname'));
            $('#editDOB').val($(this).data('dob'));
            $('#editTelephone').val($(this).data('telephone'));
            $('#editMobile').val($(this).data('mobile'));
            $('#editAddress').val($(this).data('address'));
            $('#editAddress2').val($(this).data('address2'));
            $('#editPostcode').val($(this).data('postcode'));
            $('#editEmail').val($(this).data('email'));
            $('#editStartDate').val($(this).data('startdate'));

            var editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        });
    });
</script>